<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Social Engineering Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;500;600;700&family=Roboto+Mono:wght@300;400;500&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
/* === STILI BASE === */
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: 'Rajdhani', sans-serif; background: #1a1d35; color: #fff; line-height: 1.6; }
.container { max-width: 1200px; margin: 0 auto; padding: 20px; }
header { text-align: center; margin-bottom: 30px; }
h1 { font-size: 2.5rem; letter-spacing: 3px; font-weight: 700; }
.subtitle { color: #8b95a5; font-size: 1.1rem; margin-top: 10px; letter-spacing: 1px; }
.upload-section { margin-bottom: 20px; }
.upload-area { border: 2px dashed #3a3d5c; border-radius: 10px; padding: 40px; text-align: center; cursor: pointer; transition: 0.3s; }
.upload-area.dragover { border-color: #3498db; background: rgba(52, 152, 219, 0.1); }
.upload-area input { display: none; }
.upload-icon { font-size: 3rem; margin-bottom: 10px; }
.file-info { margin-top: 10px; color: #27ae60; }
.error-msg { margin-top: 10px; color: #e74c3c; }
.search-box { padding: 8px 12px; border-radius: 6px; border: 2px solid #3a3d5c; background: #2c2f4d; color: #fff; font-family: 'Rajdhani', sans-serif; cursor: pointer; }
.upload-btn { padding: 10px 15px; border: none; border-radius: 6px; cursor: pointer; font-family: 'Rajdhani', sans-serif; color: #fff; background: #3498db; transition: 0.2s; }
.upload-btn:hover { opacity: 0.85; }
.table-container { overflow-x: auto; margin-top: 20px; }
table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
th, td { padding: 12px; text-align: left; border-bottom: 1px solid #3a3d5c; }
th { background: #2c2f4d; }
.pagination { display: flex; justify-content: center; align-items: center; gap: 10px; margin-bottom: 40px; }
.pagination button { padding: 8px 12px; border: none; border-radius: 6px; background: #3498db; color: #fff; cursor: pointer; transition: 0.2s; }
.pagination button:hover { opacity: 0.85; }
.date-input-wrapper { position: relative; }
.date-tooltip { position: absolute; top: -22px; left: 0; font-size: 0.9rem; color: #a8b2c1; }
</style>
</head>
<body>
<div class="container">
<header>
    <h1>SOCIAL ENGINEERING DASHBOARD</h1>
    <div class="subtitle">Phishing Sites & Human Attack Surface</div>
</header>

<div class="upload-section">
    <h2>UPLOAD CSV DATA</h2>
    <div class="upload-area" id="uploadArea">
        <div class="upload-icon">üìä</div>
        <p style="font-size:1.1rem;margin-bottom:.5rem">Click to upload CSV file</p>
        <p style="color:#8b95a5;margin-bottom:1rem">or drag & drop here</p>
        <input type="file" id="fileInput" accept=".csv,.tsv,.txt">
    </div>
    <div id="fileInfo" class="file-info"></div>
    <div id="errorMsg" class="error-msg"></div>
</div>

<div class="table-container" id="tableContainer">
    <!-- FILTRI -->
    <div style="display:grid;grid-template-columns:1fr 1fr 1fr 1fr 1fr 100px;gap:1rem;margin-bottom:1rem;">
        <div class="date-input-wrapper">
            <input type="date" id="dateStartFilter" class="search-box" placeholder="Start Date" title="Clicca per selezionare la data di inizio">
            <span class="date-tooltip">üìÖ Data inizio</span>
        </div>
        <div class="date-input-wrapper">
            <input type="date" id="dateEndFilter" class="search-box" placeholder="End Date" title="Clicca per selezionare la data di fine">
            <span class="date-tooltip">üìÖ Data fine</span>
        </div>
        <select id="sectorFilter" class="search-box">
            <option value="">All Sectors</option>
        </select>
        <select id="goalFilter" class="search-box">
            <option value="">All Goals</option>
        </select>
        <select id="stateFilter" class="search-box">
            <option value="">All States</option>
        </select>
        <button id="resetFiltersBtn" class="upload-btn" style="background:#e74c3c;">üîÑ Reset</button>
    </div>

    <div style="text-align:center;margin-bottom:1.5rem;">
        <button id="generatePdfBtn" class="upload-btn" style="background:#27ae60;">
            üìÑ Generate PDF Report
        </button>
    </div>

    <!-- TABELLA -->
    <table>
        <thead>
            <tr>
                <th>Site</th>
                <th>Date</th>
                <th>Sector Attacked</th>
                <th>Attack Goal</th>
                <th>State</th>
                <th>Screenshot</th>
            </tr>
        </thead>
        <tbody id="tableBody">
            <tr>
                <td colspan="6" style="text-align:center;color:#8b95a5;">No data loaded</td>
            </tr>
        </tbody>
    </table>

    <!-- PAGINAZIONE -->
    <div class="pagination">
        <button id="prevBtn">‚Üê Previous</button>
        <span id="pageInfo">Page 1</span>
        <button id="nextBtn">Next ‚Üí</button>
        <span style="margin-left: 20px; display: flex; align-items: center; gap: 8px;">
            <label for="jumpPage" style="font-size: 0.9rem; color: #a8b2c1;">Jump to page:</label>
            <input type="number" id="jumpPage" min="1" style="width: 60px; padding: 8px; background: #2c2f4d; border: 2px solid #3a3d5c; border-radius: 6px; color: #fff; font-family: 'Rajdhani', sans-serif; text-align: center;" placeholder="Page #">
            <button id="jumpBtn" class="upload-btn" style="background: #9b59b6;">Go</button>
        </span>
    </div>
</div>

<script>
// VAR GLOBALI
let currentData = [];
let filteredData = [];
let currentPage = 1;
const rowsPerPage = 10;

// ELEMENTI
const uploadArea = document.getElementById('uploadArea');
const fileInput = document.getElementById('fileInput');
const fileInfo = document.getElementById('fileInfo');
const errorMsg = document.getElementById('errorMsg');

// EVENTI UPLOAD
uploadArea.onclick = () => fileInput.click();
uploadArea.addEventListener('dragover', e => { e.preventDefault(); uploadArea.classList.add('dragover'); });
uploadArea.addEventListener('dragleave', () => { uploadArea.classList.remove('dragover'); });
uploadArea.addEventListener('drop', e => { e.preventDefault(); uploadArea.classList.remove('dragover'); const file = e.dataTransfer.files[0]; if(file) handleFile(file); });
fileInput.addEventListener('change', e => { const file = e.target.files[0]; if(file) handleFile(file); });

// FUNZIONE PARSE DATA ITALIANA
function parseItalianDate(str){
    if(!str) return '';
    const parts = str.split('/');
    if(parts.length===3){ const [d,m,y]=parts; return `${y.padStart(4,'0')}-${m.padStart(2,'0')}-${d.padStart(2,'0')}`; }
    return str;
}

// HANDLE FILE
function handleFile(file){
    errorMsg.textContent = '';
    fileInfo.textContent = `üìÅ Loading ${file.name}...`;
    const reader = new FileReader();
    reader.onload = function(e){
        try{
            const text = e.target.result;
            const lines = text.split('\n').filter(l=>l.trim());
            const delimiter = (lines[0].match(/\t/g)||[]).length>(lines[0].match(/,/g)||[]).length?'\t':',';
            const headers = lines[0].split(delimiter).map(h=>h.trim());
            let siteIdx=-1,dateIdx=-1,sectorIdx=-1,goalIdx=-1,screenshotIdx=-1,stateIdx=-1;
            headers.forEach((h,i)=>{
                const lower=h.toLowerCase();
                if(lower.includes('site')||lower.includes('sito')||lower.includes('url')) siteIdx=i;
                if(lower.includes('last')||lower.includes('date')||lower.includes('data')||lower.includes('seen')) dateIdx=i;
                if(lower.includes('sector')&&lower.includes('attack')) sectorIdx=i;
                if(lower.includes('goal')||lower.includes('obiettivo')) goalIdx=i;
                if(lower.includes('screenshot')||lower.includes('image')||lower.includes('foto')) screenshotIdx=i;
                if(lower.includes('state')) stateIdx=i;
            });
            const data=[];
            for(let i=1;i<lines.length;i++){
                const vals=lines[i].split(delimiter);
                if(vals[siteIdx]){
                    data.push({
                        site: vals[siteIdx]||'',
                        date: dateIdx!==-1?parseItalianDate(vals[dateIdx]):'',
                        sector: sectorIdx!==-1?vals[sectorIdx].trim().toUpperCase():'UNKNOWN',
                        goal: goalIdx!==-1?vals[goalIdx].trim().toUpperCase():'UNKNOWN',
                        state: stateIdx!==-1?vals[stateIdx].trim().toUpperCase():'UNKNOWN',
                        screenshot: screenshotIdx!==-1?vals[screenshotIdx]:'',
                        rowIndex: i
                    });
                }
            }
            currentData = data;
            filteredData = data;
            fileInfo.textContent = `‚úì Successfully loaded ${data.length} records`;
            populateFilters(data);
            displayPage(filteredData,1);
        }catch(err){ errorMsg.textContent='‚ö†Ô∏è Error: '+err.message; console.error(err); }
    };
    reader.readAsText(file);
}

// POPOLA FILTRI
function populateFilters(data){
    const sectors=[...new Set(data.map(r=>r.sector))].sort();
    const sectorSelect=document.getElementById('sectorFilter'); sectorSelect.innerHTML='<option value="">All Sectors</option>';
    sectors.forEach(s=>{ const o=document.createElement('option'); o.value=s; o.textContent=s; sectorSelect.appendChild(o); });

    const goals=[...new Set(data.map(r=>r.goal))].sort();
    const goalSelect=document.getElementById('goalFilter'); goalSelect.innerHTML='<option value="">All Goals</option>';
    goals.forEach(g=>{ const o=document.createElement('option'); o.value=g; o.textContent=g; goalSelect.appendChild(o); });

    const states=[...new Set(data.map(r=>r.state))].sort();
    const stateSelect=document.getElementById('stateFilter'); stateSelect.innerHTML='<option value="">All States</option>';
    states.forEach(s=>{ const o=document.createElement('option'); o.value=s; o.textContent=s; stateSelect.appendChild(o); });
}

// APPLY FILTERS
function applyFilters(){
    const dateStart=document.getElementById('dateStartFilter').value;
    const dateEnd=document.getElementById('dateEndFilter').value;
    const sectorFilter=document.getElementById('sectorFilter').value;
    const goalFilter=document.getElementById('goalFilter').value;
    const stateFilter=document.getElementById('stateFilter').value;
    filteredData = currentData.filter(r=>{
        if(dateStart && r.date<dateStart) return false;
        if(dateEnd && r.date>dateEnd) return false;
        if(sectorFilter && r.sector!==sectorFilter) return false;
        if(goalFilter && r.goal!==goalFilter) return false;
        if(stateFilter && r.state!==stateFilter) return false;
        return true;
    });
    displayPage(filteredData,1);
}

// EVENTI FILTRI
document.getElementById('dateStartFilter').addEventListener('change',applyFilters);
document.getElementById('dateEndFilter').addEventListener('change',applyFilters);
document.getElementById('sectorFilter').addEventListener('change',applyFilters);
document.getElementById('goalFilter').addEventListener('change',applyFilters);
document.getElementById('stateFilter').addEventListener('change',applyFilters);
document.getElementById('resetFiltersBtn').addEventListener('click',()=>{
    document.getElementById('dateStartFilter').value='';
    document.getElementById('dateEndFilter').value='';
    document.getElementById('sectorFilter').value='';
    document.getElementById('goalFilter').value='';
    document.getElementById('stateFilter').value='';
    applyFilters();
});

// DISPLAY PAGINA
function displayPage(data,page){
    currentPage = page;
    const tbody=document.getElementById('tableBody'); tbody.innerHTML='';
    const start=(page-1)*rowsPerPage; const end=start+rowsPerPage;
    const pageData=data.slice(start,end);
    if(pageData.length===0){ tbody.innerHTML='<tr><td colspan="6" style="text-align:center;color:#8b95a5;">No records</td></tr>'; }
    else{
        pageData.forEach(r=>{
            const tr=document.createElement('tr');
            tr.innerHTML=`<td>${r.site}</td><td>${r.date}</td><td>${r.sector}</td><td>${r.goal}</td><td>${r.state}</td><td>${r.screenshot?'<a href="'+r.screenshot+'" target="_blank">View</a>':'-'}</td>`;
            tbody.appendChild(tr);
        });
    }
    document.getElementById('pageInfo').textContent=`Page ${currentPage} of ${Math.ceil(data.length/rowsPerPage) || 1}`;
}

// PAGINAZIONE
document.getElementById('prevBtn').addEventListener('click',()=>{ if(currentPage>1) displayPage(filteredData,currentPage-1); });
document.getElementById('nextBtn').addEventListener('click',()=>{ if(currentPage<Math.ceil(filteredData.length/rowsPerPage)) displayPage(filteredData,currentPage+1); });
document.getElementById('jumpBtn').addEventListener('click',()=>{
    const val=parseInt(document.getElementById('jumpPage').value);
    if(val>=1 && val<=Math.ceil(filteredData.length/rowsPerPage)) displayPage(filteredData,val);
});
</script>
</body>
</html>
