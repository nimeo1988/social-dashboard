<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Social Engineering Dashboard</title>

<link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;500;600;700&family=Roboto+Mono:wght@300;400;500&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<style>
/* RESET & BASE */
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: 'Rajdhani', sans-serif; background: #1a1d35; color: #fff; line-height: 1.6; }
.container { max-width: 1200px; margin: 0 auto; padding: 20px; }
header { text-align: center; margin-bottom: 30px; padding: 20px 0; }
h1 { font-size: 2.5rem; letter-spacing: 3px; font-weight: 700; margin: 0; }
.subtitle { color: #8b95a5; font-size: 1.1rem; margin-top: 10px; letter-spacing: 1px; }

/* UPLOAD */
.upload-section { background: #22253a; padding: 30px; border-radius: 12px; margin-bottom: 30px; box-shadow: 0 4px 6px rgba(0,0,0,0.3); }
.upload-section h2 { margin-bottom: 20px; color: #fff; letter-spacing: 2px; font-size: 1.3rem; }
.upload-area { border: 3px dashed #2962FF; padding: 40px 20px; text-align: center; cursor: pointer; border-radius: 12px; transition: all 0.3s ease; background: rgba(41, 98, 255, 0.05); }
.upload-area:hover { border-color: #4CAF50; background: rgba(76, 175, 80, 0.1); }
.upload-area.dragover { border-color: #4CAF50; background: rgba(76, 175, 80, 0.15); transform: scale(1.02); }
.upload-icon { font-size: 3rem; margin-bottom: 10px; }
.file-input { display: none; }
.file-info { margin-top: 15px; font-size: 0.95rem; color: #27ae60; font-weight: 500; }
.error-msg { margin-top: 15px; font-size: 0.95rem; color: #e74c3c; font-weight: 500; }

/* TABLE */
.table-container { background: #22253a; padding: 30px; border-radius: 12px; margin-bottom: 30px; box-shadow: 0 4px 6px rgba(0,0,0,0.3); display: none; opacity: 0; transform: translateY(20px); transition: all 0.5s ease; }
.table-container.active { display: block; opacity: 1; transform: translateY(0); }
table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
th, td { padding: 12px 15px; text-align: left; font-size: 0.9rem; border-bottom: 1px solid #2c2f4d; }
th { background: #1a1d35; font-weight: 600; letter-spacing: 1px; text-transform: uppercase; font-size: 0.85rem; color: #a8b2c1; }
tr:hover { background: rgba(41, 98, 255, 0.05); }
.screenshot-thumbnail { width: 80px; height: 50px; object-fit: cover; cursor: pointer; border-radius: 6px; transition: all 0.3s ease; border: 2px solid #2c2f4d; }
.screenshot-thumbnail:hover { transform: scale(1.1); border-color: #2962FF; box-shadow: 0 4px 12px rgba(41, 98, 255, 0.5); }
.screenshot-cell { text-align: center; }

/* PAGINATION */
.pagination { text-align: center; margin: 20px 0; display: flex; justify-content: center; align-items: center; gap: 15px; }
.pagination button { padding: 10px 20px; background: #2c2f4d; border: 2px solid #3a3d5c; color: #fff; border-radius: 8px; cursor: pointer; font-family: 'Rajdhani', sans-serif; font-weight: 600; transition: all 0.3s ease; }
.pagination button:hover:not(:disabled) { background: #2962FF; border-color: #2962FF; }
.pagination button:disabled { opacity: 0.3; cursor: not-allowed; }
#pageInfo { font-weight: 600; color: #a8b2c1; }

/* MODAL */
.modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); justify-content: center; align-items: center; }
.modal-content { max-width: 90%; max-height: 90%; border-radius: 8px; box-shadow: 0 8px 32px rgba(0,0,0,0.5); }
.close { position: absolute; top: 30px; right: 40px; color: #fff; font-size: 40px; font-weight: bold; cursor: pointer; transition: all 0.3s ease; }
.close:hover { color: #2962FF; transform: scale(1.2); }
</style>
</head>

<body>
<div class="container">
<header>
    <h1>SOCIAL ENGINEERING DASHBOARD</h1>
    <div class="subtitle">Phishing Sites & Human Attack Surface</div>
</header>

<div class="upload-section">
    <h2>UPLOAD EXCEL DATA</h2>
    <div class="upload-area" id="uploadArea">
        <div class="upload-icon">üìä</div>
        <p>Click to upload Excel file</p>
        <input type="file" id="excelInput" class="file-input" accept=".xlsx,.xls">
    </div>
    <div id="fileInfo" class="file-info"></div>
    <div id="errorMsg" class="error-msg"></div>
</div>

<div class="table-container" id="tableContainer">
    <table>
        <thead>
            <tr>
                <th>Site</th>
                <th>Date</th>
                <th>Sector Attacked</th>
                <th>Attack Goal</th>
                <th>Screenshot</th>
            </tr>
        </thead>
        <tbody id="tableBody">
            <tr><td colspan="5" style="text-align:center;color:#8b95a5;">No data loaded</td></tr>
        </tbody>
    </table>
    <div class="pagination">
        <button id="prevBtn">‚Üê Previous</button>
        <span id="pageInfo">Page 1</span>
        <button id="nextBtn">Next ‚Üí</button>
    </div>
</div>

<div id="imageModal" class="modal" onclick="closeModal()">
    <span class="close">&times;</span>
    <img class="modal-content" id="modalImage">
</div>
</div>

<script>
let currentData = [];
let filteredData = [];
let currentPage = 1;
const rowsPerPage = 10;
const colors = ['#5a8db8','#e74c3c','#e67e22','#7b8794','#3498db','#9b59b6','#27ae60','#f39c12','#c0392b','#16a085','#8e44ad','#2c3e50','#e67e22','#95a5a6','#34495e'];

const excelInput = document.getElementById('excelInput');
const tableContainer = document.getElementById('tableContainer');
const tableBody = document.getElementById('tableBody');
const fileInfo = document.getElementById('fileInfo');
const errorMsg = document.getElementById('errorMsg');

const uploadArea = document.getElementById('uploadArea');
uploadArea.onclick = () => excelInput.click();

function getLocalImagePath(rowIndex){
    return `images/${rowIndex}.png`;
}

function showImage(path){
    const modal = document.getElementById('imageModal');
    const modalImg = document.getElementById('modalImage');
    modal.style.display = 'flex';
    modalImg.src = path;
}

function closeModal(){
    document.getElementById('imageModal').style.display='none';
}

document.addEventListener('keydown', e=>{if(e.key==='Escape') closeModal();});

excelInput.addEventListener('change', async (e) => {
    const file = e.target.files[0];
    if (!file) return;
    fileInfo.textContent = `üìÅ Loading ${file.name}...`;
    errorMsg.textContent = '';
    try {
        const data = await file.arrayBuffer();
        const workbook = XLSX.read(data, { type: 'array' });
        const sheetName = workbook.SheetNames[0];
        const sheet = workbook.Sheets[sheetName];
        const jsonData = XLSX.utils.sheet_to_json(sheet, { header: 1 });
        if(jsonData.length < 2) throw new Error("File vuoto");

        const header = jsonData[0];
        const rows = jsonData.slice(1);
        const siteIdx = header.findIndex(h=>h.toLowerCase().includes('site'));
        const dateIdx = header.findIndex(h=>h.toLowerCase().includes('date'));
        const sectorIdx = header.findIndex(h=>h.toLowerCase().includes('sector'));
        const goalIdx = header.findIndex(h=>h.toLowerCase().includes('goal'));
        const rowIndexIdx = header.findIndex(h=>h.toLowerCase().includes('row')||h.toLowerCase().includes('index'));

        if(siteIdx===-1||sectorIdx===-1||goalIdx===-1) throw new Error("Colonne richieste mancanti");

        currentData = rows.map((row,i)=>({
            site: row[siteIdx]||'',
            date: dateIdx!==-1?row[dateIdx]:'',
            sector: (row[sectorIdx]||'UNKNOWN').toUpperCase(),
            goal: (row[goalIdx]||'UNKNOWN').toUpperCase(),
            rowIndex: rowIndexIdx!==-1?row[rowIndexIdx]:i+1
        })).filter(r=>r.site);

        filteredData = currentData;
        fileInfo.textContent = `‚úì Loaded ${currentData.length} records`;
        tableContainer.classList.add('active');
        displayPage(filteredData,1);

    } catch(err){
        console.error(err);
        errorMsg.textContent = '‚ö†Ô∏è Errore nel leggere il file. Controlla formato .xlsx/.xls';
        fileInfo.textContent='';
    }
});

document.getElementById('prevBtn').onclick = () => { if(currentPage>1){ currentPage--; displayPage(filteredData,currentPage); }};
document.getElementById('nextBtn').onclick = () => { const total=Math.ceil(filteredData.length/rowsPerPage); if(currentPage<total){ currentPage++; displayPage(filteredData,currentPage); }};

function displayPage(data,page){
    currentPage=page;
    tableBody.innerHTML='';
    const start=(page-1)*rowsPerPage;
    const pageData=data.slice(start,start+rowsPerPage);
    if(pageData.length===0){ tableBody.innerHTML='<tr><td colspan="5" style="text-align:center;color:#8b95a5;">No data found</td></tr>'; return; }
    pageData.forEach(r=>{
        const siteDisplay=r.site.length>50?r.site.substring(0,47)+'...':r.site;
        const dateDisplay=r.date?r.date.substring(0,10):'-';
        const imagePath=getLocalImagePath(r.rowIndex);
        const screenshotCell=`<img src="${imagePath}" class="screenshot-thumbnail" onclick="event.stopPropagation(); showImage('${imagePath}')" onerror="this.style.display='none'">`;
        tableBody.innerHTML+=`<tr><td title="${r.site}">${siteDisplay}</td><td>${dateDisplay}</td><td>${r.sector}</td><td>${r.goal}</td><td class="screenshot-cell">${screenshotCell}</td></tr>`;
    });
    const total=Math.ceil(data.length/rowsPerPage)||1;
    document.getElementById('pageInfo').textContent=`Page ${page} of ${total} (${data.length} records)`;
    document.getElementById('prevBtn').disabled=page===1;
    document.getElementById('nextBtn').disabled=page===total;
}
</script>
</body>
</html>
