<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Social Engineering Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;500;600;700&family=Roboto+Mono:wght@300;400;500&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
/* RESET & BASE */
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: 'Rajdhani', sans-serif; background: #1a1d35; color: #fff; line-height: 1.6; }

/* CONTAINER */
.container { max-width: 1200px; margin: 0 auto; padding: 20px; }

/* HEADER */
header { text-align: center; margin-bottom: 30px; padding: 20px 0; }
h1 { font-size: 2.5rem; letter-spacing: 3px; font-weight: 700; margin: 0; }
.subtitle { color: #8b95a5; font-size: 1.1rem; margin-top: 10px; letter-spacing: 1px; }

/* UPLOAD SECTION */
.upload-section { background: #22253a; padding: 30px; border-radius: 12px; margin-bottom: 30px; box-shadow: 0 4px 6px rgba(0,0,0,0.3); }
.upload-section h2 { margin-bottom: 20px; color: #fff; letter-spacing: 2px; font-size: 1.3rem; }
.upload-area { border: 3px dashed #2962FF; padding: 40px 20px; text-align: center; cursor: pointer; border-radius: 12px; transition: all 0.3s ease; background: rgba(41, 98, 255, 0.05); }
.upload-area:hover { border-color: #4CAF50; background: rgba(76, 175, 80, 0.1); }
.upload-area.dragover { border-color: #4CAF50; background: rgba(76, 175, 80, 0.15); transform: scale(1.02); }
.upload-icon { font-size: 3rem; margin-bottom: 10px; }
.file-input { display: none; }
.file-info { margin-top: 15px; font-size: 0.95rem; color: #27ae60; font-weight: 500; }
.error-msg { margin-top: 15px; font-size: 0.95rem; color: #e74c3c; font-weight: 500; }

/* TABLE CONTAINER */
.table-container { background: #22253a; padding: 30px; border-radius: 12px; margin-bottom: 30px; box-shadow: 0 4px 6px rgba(0,0,0,0.3); display: none; opacity: 0; transform: translateY(20px); transition: all 0.5s ease; }
.table-container.active { display: block; opacity: 1; transform: translateY(0); }

/* SEARCH & FILTERS */
.search-box { padding: 12px 15px; background: #2c2f4d; border: 2px solid #3a3d5c; border-radius: 8px; color: #fff; font-size: 0.95rem; font-family: 'Rajdhani', sans-serif; transition: all 0.3s ease; }
.search-box:focus { outline: none; border-color: #2962FF; background: #1a1d35; }
.search-box::placeholder { color: #8b95a5; }

/* BUTTON */
.upload-btn { padding: 12px 24px; background: #2962FF; color: #fff; border: none; border-radius: 8px; font-size: 1rem; font-family: 'Rajdhani', sans-serif; font-weight: 600; cursor: pointer; transition: all 0.3s ease; letter-spacing: 0.5px; }
.upload-btn:hover { background: #1e4ed8; transform: translateY(-2px); box-shadow: 0 4px 12px rgba(41, 98, 255, 0.4); }
.upload-btn:active { transform: translateY(0); }
.upload-btn:disabled { background: #555; cursor: not-allowed; transform: none; }

/* TABLE */
table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
th, td { padding: 12px 15px; text-align: left; font-size: 0.9rem; border-bottom: 1px solid #2c2f4d; }
th { background: #1a1d35; font-weight: 600; letter-spacing: 1px; text-transform: uppercase; font-size: 0.85rem; color: #a8b2c1; }
tr:hover { background: rgba(41, 98, 255, 0.05); }

/* IMMAGINI IN TABLLA */
.screenshot-cell img { width: 80px; height: 45px; object-fit: cover; border-radius: 4px; cursor: pointer; transition: transform 0.2s ease; }
.screenshot-cell img:hover { transform: scale(1.2); }

/* MODAL IMMAGINE */
.modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); justify-content: center; align-items: center; }
.modal-content { max-width: 90%; max-height: 90%; border-radius: 6px; box-shadow: 0 0 15px rgba(0,0,0,0.5); }
.modal .close { position: absolute; top: 20px; right: 35px; color: #fff; font-size: 40px; font-weight: bold; cursor: pointer; }
.modal .close:hover { color: #ccc; }

/* PAGINATION */
.pagination { text-align: center; margin: 20px 0; display: flex; justify-content: center; align-items: center; gap: 15px; }
.pagination button { padding: 10px 20px; background: #2c2f4d; border: 2px solid #3a3d5c; color: #fff; border-radius: 8px; cursor: pointer; font-family: 'Rajdhani', sans-serif; font-weight: 600; transition: all 0.3s ease; }
.pagination button:hover:not(:disabled) { background: #2962FF; border-color: #2962FF; }
.pagination button:disabled { opacity: 0.3; cursor: not-allowed; }

/* RESPONSIVE */
@media (max-width: 768px) {
    .charts-grid-two-cols { grid-template-columns: 1fr; }
    h1 { font-size: 1.8rem; }
    .container { padding: 15px; }
}
</style>
</head>

<body>
<div class="container">
<header>
    <h1>SOCIAL ENGINEERING DASHBOARD</h1>
    <div class="subtitle">Phishing Sites & Human Attack Surface</div>
</header>

<div class="upload-section">
    <h2>UPLOAD XLS/XLSX FILE</h2>
    <div class="upload-area" id="uploadArea">
        <div class="upload-icon">üìä</div>
        <p style="font-size:1.1rem;margin-bottom:.5rem">Click to upload Excel file</p>
        <input type="file" id="fileInput" class="file-input" accept=".xlsx,.xls">
    </div>
    <div id="fileInfo" class="file-info"></div>
    <div id="errorMsg" class="error-msg"></div>
</div>

<div class="table-container" id="tableContainer">
    <div style="display:grid;grid-template-columns:1fr 1fr 1fr 1fr 100px;gap:1rem;margin-bottom:1rem;">
        <input type="date" id="dateStartFilter" class="search-box" placeholder="Start Date">
        <input type="date" id="dateEndFilter" class="search-box" placeholder="End Date">
        <select id="sectorFilter" class="search-box" style="cursor:pointer;"><option value="">All Sectors</option></select>
        <select id="goalFilter" class="search-box" style="cursor:pointer;"><option value="">All Goals</option></select>
        <button id="resetFiltersBtn" class="upload-btn" style="background:#e74c3c;padding:0.9rem 1rem;font-size:0.9rem;">üîÑ Reset</button>
    </div>

    <table>
        <thead>
            <tr>
                <th>Site</th>
                <th>Date</th>
                <th>Sector Attacked</th>
                <th>Attack Goal</th>
                <th>Screenshot</th>
            </tr>
        </thead>
        <tbody id="tableBody">
            <tr><td colspan="5" style="text-align:center;color:#8b95a5;">No data loaded</td></tr>
        </tbody>
    </table>

    <div class="pagination">
        <button id="prevBtn">‚Üê Previous</button>
        <span id="pageInfo">Page 1</span>
        <button id="nextBtn">Next ‚Üí</button>
    </div>
</div>

<!-- MODAL -->
<div id="imageModal" class="modal" onclick="closeModal()">
    <span class="close">&times;</span>
    <img class="modal-content" id="modalImage">
</div>

<script>
// Variabili globali
let currentData=[], filteredData=[], currentPage=1, rowsPerPage=10;

// Funzioni modal
function showImage(src){document.getElementById('modalImage').src=src;document.getElementById('imageModal').style.display='flex';}
function closeModal(){document.getElementById('imageModal').style.display='none';}
document.addEventListener('keydown', e=>{if(e.key==='Escape') closeModal();});

// Funzione per ottenere percorso immagine da GitHub
function getGitHubImagePath(name){return `https://raw.githubusercontent.com/nimeo1988/social-dasboard/main/images/${name}`;}

// Upload Excel
document.getElementById('uploadArea').onclick=()=>document.getElementById('fileInput').click();
document.getElementById('fileInput').addEventListener('change',e=>{const f=e.target.files[0];if(f) readExcel(f);});

function readExcel(file){
    const reader=new FileReader();
    reader.onload=function(e){
        const data=new Uint8Array(e.target.result);
        const wb=XLSX.read(data,{type:'array'});
        const ws=wb.Sheets[wb.SheetNames[0]];
        const json=XLSX.utils.sheet_to_json(ws,{defval:""});
        if(json.length===0){document.getElementById('errorMsg').textContent='‚ö†Ô∏è File vuoto';return;}
        currentData=json.map((row,i)=>({
            site: row['Site']||row['Sito']||row['URL']||'',
            date: row['Date']||row['Data']||'',
            sector: (row['Sector']||row['Settore']||'').toUpperCase(),
            goal: (row['Goal']||row['Obiettivo']||'').toUpperCase(),
            screenshot: row['Screenshot']||row['Immagine']||`${i+1}.png`
        }));
        filteredData=currentData;
        document.getElementById('fileInfo').textContent=`‚úì Caricati ${currentData.length} record`;
        document.getElementById('tableContainer').classList.add('active');
        populateFilters();
        displayPage(1);
    };
    reader.readAsArrayBuffer(file);
}

// Popola filtri
function populateFilters(){
    const sectors=[...new Set(currentData.map(r=>r.sector))].sort();
    const sectorSelect=document.getElementById('sectorFilter');
    sectorSelect.innerHTML='<option value="">All Sectors</option>';
    sectors.forEach(s=>{const opt=document.createElement('option');opt.value=s;opt.textContent=s;sectorSelect.appendChild(opt);});

    const goals=[...new Set(currentData.map(r=>r.goal))].sort();
    const goalSelect=document.getElementById('goalFilter');
    goalSelect.innerHTML='<option value="">All Goals</option>';
    goals.forEach(g=>{const opt=document.createElement('option');opt.value=g;opt.textContent=g;goalSelect.appendChild(opt);});
}

// Filtri
['dateStartFilter','dateEndFilter','sectorFilter','goalFilter'].forEach(id=>{
    document.getElementById(id).addEventListener('change',applyFilters);
});
document.getElementById('resetFiltersBtn').addEventListener('click',()=>{
    ['dateStartFilter','dateEndFilter','sectorFilter','goalFilter'].forEach(id=>document.getElementById(id).value='');
    applyFilters();
});
function applyFilters(){
    const ds=document.getElementById('dateStartFilter').value,de=document.getElementById('dateEndFilter').value,sf=document.getElementById('sectorFilter').value,gf=document.getElementById('goalFilter').value;
    filteredData=currentData.filter(r=>{
        if(ds && r.date<ds) return false;
        if(de && r.date>de) return false;
        if(sf && r.sector!==sf) return false;
        if(gf && r.goal!==gf) return false;
        return true;
    });
    displayPage(1);
}

// Pagina
document.getElementById('prevBtn').onclick=()=>{if(currentPage>1){displayPage(currentPage-1);}};
document.getElementById('nextBtn').onclick=()=>{if(currentPage<Math.ceil(filteredData.length/rowsPerPage)){displayPage(currentPage+1);}};
function displayPage(page){
    currentPage=page;
    const tbody=document.getElementById('tableBody');
    tbody.innerHTML='';
    const start=(page-1)*rowsPerPage;
    const pageData=filteredData.slice(start,start+rowsPerPage);
    if(pageData.length===0){tbody.innerHTML='<tr><td colspan="5" style="text-align:center;color:#8b95a5;">No data found</td></tr>';return;}
    pageData.forEach(r=>{
        const siteDisplay=r.site.length>50?r.site.substring(0,47)+'...':r.site;
        const dateDisplay=r.date?r.date.substring(0,10):'-';
        const imgPath=getGitHubImagePath(r.screenshot);
        const screenshotCell=`<img src="${imgPath}" alt="Screenshot" onclick="event.stopPropagation();showImage('${imgPath}')" onerror="this.style.display='none'">`;
        tbody.innerHTML+=`<tr><td title="${r.site}">${siteDisplay}</td><td>${dateDisplay}</td><td>${r.sector}</td><td>${r.goal}</td><td class="screenshot-cell">${screenshotCell}</td></tr>`;
    });
    const total=Math.ceil(filteredData.length/rowsPerPage)||1;
    document.getElementById('pageInfo').textContent=`Page ${page} of ${total} (${filteredData.length} records)`;
    document.getElementById('prevBtn').disabled=page===1;
    document.getElementById('nextBtn').disabled=page===total;
}
</script>
</body>
</html>
